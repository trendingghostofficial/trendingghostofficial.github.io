import{K as p,Ma as d,O as g,Sb as b,Ta as m,g as s,hc as h,j as u,o as l,w as a}from"./chunk-RWH3TDFH.js";var c=class o{constructor(t){this.http=t;this.detectLanguage(),this.loadIdiomasDisponibles(),this.loadUITranslations(this.getCurrentLanguageSync())}currentLang$=new s("es");idiomasDisponibles$=new s([]);uiTranslations={};translationsLoaded$=new s(!1);SUPPORTED_LANGS=["es","en","ja","pt","fr","de","it","ko","zh-CN","zh-TW","ru","pl","tr","hi","ar"];DATA_BASE_URL="https://raw.githubusercontent.com/trendingghostofficial/trending-ghost-data/main";detectLanguage(){let i=new URLSearchParams(window.location.search).get("lang");if(i&&this.SUPPORTED_LANGS.includes(i)){this.setLanguage(i);return}let e=localStorage.getItem("preferred_lang");if(e&&this.SUPPORTED_LANGS.includes(e)){this.setLanguage(e);return}let n=navigator.language.split("-")[0];if(this.SUPPORTED_LANGS.includes(n)){this.setLanguage(n);return}this.setLanguage("es")}setLanguage(t){this.SUPPORTED_LANGS.includes(t)||(console.warn(`[i18n] Idioma no soportado: ${t}, usando 'es'`),t="es"),this.currentLang$.next(t),localStorage.setItem("preferred_lang",t),this.loadUITranslations(t);let i=new URL(window.location.href);i.searchParams.set("lang",t),window.history.replaceState({},"",i.toString())}getCurrentLanguage(){return this.currentLang$.asObservable()}getCurrentLanguageSync(){return this.currentLang$.value}loadIdiomasDisponibles(){this.http.get("assets/i18n/idiomas.json").pipe(l(i=>(i.idiomas||[]).filter(r=>r.activo===!0)),a(i=>(console.error("[i18n] \u274C Error cargando idiomas:",i),u([{codigo:"es",nombre_nativo:"Espa\xF1ol",nombre_ingles:"Spanish",emoji:"\u{1F1EA}\u{1F1F8}",icono_emoji:"\u{1F1EA}\u{1F1F8}",activo:!0,es_original:!0,capitulos_traducidos:0,capitulos_totales:0,porcentaje:100},{codigo:"en",nombre_nativo:"English",nombre_ingles:"English",emoji:"\u{1F1EC}\u{1F1E7}",icono_emoji:"\u{1F1EC}\u{1F1E7}",activo:!0,es_original:!1,capitulos_traducidos:0,capitulos_totales:0,porcentaje:0},{codigo:"ja",nombre_nativo:"\u65E5\u672C\u8A9E",nombre_ingles:"Japanese",emoji:"\u{1F1EF}\u{1F1F5}",icono_emoji:"\u{1F1EF}\u{1F1F5}",activo:!0,es_original:!1,capitulos_traducidos:0,capitulos_totales:0,porcentaje:0},{codigo:"pt",nombre_nativo:"Portugu\xEAs",nombre_ingles:"Portuguese",emoji:"\u{1F1E7}\u{1F1F7}",icono_emoji:"\u{1F1E7}\u{1F1F7}",activo:!0,es_original:!1,capitulos_traducidos:0,capitulos_totales:0,porcentaje:0},{codigo:"fr",nombre_nativo:"Fran\xE7ais",nombre_ingles:"French",emoji:"\u{1F1EB}\u{1F1F7}",icono_emoji:"\u{1F1EB}\u{1F1F7}",activo:!0,es_original:!1,capitulos_traducidos:0,capitulos_totales:0,porcentaje:0}])))).subscribe(i=>{this.idiomasDisponibles$.next(i)})}getIdiomasDisponibles(){return this.idiomasDisponibles$.asObservable()}loadChapter(t,i){let e=i||this.getCurrentLanguageSync();return this.tryLoadChapter(t,e).pipe(a(n=>(console.warn(`[i18n] Cap\xEDtulo no disponible en ${e}, intentando fallback`),e!=="en"?this.tryLoadChapter(t,"en").pipe(a(()=>this.tryLoadChapter(t,"es"))):this.tryLoadChapter(t,"es"))))}tryLoadChapter(t,i){let e=i==="es"?`${t}.json`:`${t}.${i}.json`,n=`${this.DATA_BASE_URL}/capitulos/${e}`;return this.http.get(n).pipe(l(r=>(r.idioma=i,r)))}isLanguageAvailable(t,i){return t.idiomas_disponibles?.includes(i)||!1}getLanguageName(t){return this.idiomasDisponibles$.value.find(n=>n.codigo===t)?.nombre_nativo||t.toUpperCase()}getLanguageEmoji(t){return this.idiomasDisponibles$.value.find(n=>n.codigo===t)?.emoji||"\u{1F310}"}needsReview(t){return t.traduccion_info?.necesita_revision||!1}getTranslationMethod(t){let i=t.traduccion_info?.metodo;return{manual:"Traducci\xF3n manual",deepl:"Traducido con DeepL",chatgpt:"Traducido con ChatGPT",community:"Traducci\xF3n comunitaria",unavailable:"Traducci\xF3n no disponible"}[i||"unavailable"]||"Traducci\xF3n autom\xE1tica"}loadUITranslations(t){let i=`assets/i18n/${t}.json`;this.http.get(i).pipe(a(e=>(console.error(`[i18n] \u274C Error cargando traducciones UI para ${t}:`,e),t!=="es"?this.http.get("assets/i18n/es.json"):u({})))).subscribe(e=>{this.uiTranslations=e,this.translationsLoaded$.next(!0)})}getTranslation(t){if(!this.translationsLoaded$.value)return console.warn("[i18n] Traducciones a\xFAn no cargadas, retornando key"),t;let i=t.split("."),e=this.uiTranslations;for(let n of i)if(e&&typeof e=="object"&&n in e)e=e[n];else return console.warn(`[i18n] Traducci\xF3n no encontrada: ${t}`),t;return typeof e=="string"?e:t}areTranslationsLoaded(){return this.translationsLoaded$.value}onTranslationsLoaded(){return this.translationsLoaded$.asObservable()}static \u0275fac=function(i){return new(i||o)(g(h))};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};var f=class o{constructor(t,i){this.i18n=t;this.cdr=i;this.langSubscription=this.i18n.getCurrentLanguage().subscribe(e=>{this.lastLang!==e&&(this.lastLang=e,this.cdr.markForCheck())}),this.translationsSubscription=this.i18n.onTranslationsLoaded().subscribe(e=>{e&&this.cdr.markForCheck()})}lastLang="";langSubscription;translationsSubscription;ngOnDestroy(){this.langSubscription?.unsubscribe(),this.translationsSubscription?.unsubscribe()}transform(t,i){let e=this.i18n.getTranslation(t);return i&&e&&Object.keys(i).forEach(n=>{let r=new RegExp(`{{\\s*${n}\\s*}}`,"g");e=e.replace(r,i[n])}),e}static \u0275fac=function(i){return new(i||o)(d(c,16),d(b,16))};static \u0275pipe=m({name:"translate",type:o,pure:!1})};export{c as a,f as b};
