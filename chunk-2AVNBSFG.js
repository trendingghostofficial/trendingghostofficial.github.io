import{C as p,K as m,O as b,hc as d,j as a,o as u,w as l}from"./chunk-RWH3TDFH.js";var g=class s{constructor(e){this.http=e}WORKER_URL="https://worker-data.trendingghostofficial.workers.dev/api/data";FALLBACK_URL="/data";indexCache$;useWorker=!0;getIndex(){if(!this.indexCache$){let e=this.useWorker?`${this.WORKER_URL}/arcs`:`${this.FALLBACK_URL}/arcs.json`;this.indexCache$=this.http.get(e).pipe(u(t=>{let r=t.volumenes.map(o=>({numero:o.numero,titulo:o.titulo,subtitulo:o.subtitulo||"",rango:o.rango,estado:o.estado,color_tema:o.color_tema,capitulos_publicados:o.capitulos_publicados||0,fecha_inicio:o.fecha_inicio,fecha_fin_estimada:o.fecha_fin_estimada,capitulos:(o.capitulos||[]).map(i=>({numero:i.numero,titulo:i.titulo,slug:i.slug,fecha:i.fecha_publicacion||"",publicado:i.publicado===1||i.publicado===!0,minutos:i.minutos_lectura||0,palabras:i.palabras||0,icono:i.icono||"\u{1F4D6}",excerpt:i.excerpt||null}))})),n=r.reduce((o,i)=>o+i.capitulos.length,0),h=r.reduce((o,i)=>o+i.capitulos.filter(_=>_.publicado).length,0),c="",f="";return r.forEach(o=>{o.capitulos.forEach(i=>{i.publicado&&i.fecha&&i.fecha>c&&(c=i.fecha)})}),{total:n,publicados:h,ultimo_publicado:c,proximo_publicacion:f||void 0,volumenes:r}}),p(1),l(t=>a({total:0,publicados:0,ultimo_publicado:"",volumenes:[]})))}return this.indexCache$}getCapitulo(e){let t=this.useWorker?`${this.WORKER_URL}/capitulos/${e}`:`${this.FALLBACK_URL}/capitulos/${e}.json`;return this.http.get(t).pipe(l(r=>this.useWorker?this.http.get(`${this.FALLBACK_URL}/capitulos/${e}.json`).pipe(l(()=>a(null))):a(null)))}getCapituloPorNumero(e,t){let r=`v${e}-c${t}`;return this.getCapitulo(r)}getCapitulosDelVolumen(e){return this.getIndex().pipe(u(t=>{let r=t.volumenes.find(n=>n.numero===e);return r?r.capitulos:[]}))}getVolumen(e){return this.getIndex().pipe(u(t=>t.volumenes.find(r=>r.numero===e)||null))}getVolumenes(){return this.getIndex().pipe(u(e=>e.volumenes))}getProgresoVolumen(e){return this.getCapitulosDelVolumen(e).pipe(u(t=>t.length===0?0:t.filter(n=>n.publicado).length/t.length*100))}getProgresoGlobal(){return this.getIndex().pipe(u(e=>e.total===0?0:e.publicados/e.total*100))}getCapitulosPublicados(){return this.getIndex().pipe(u(e=>{let t=[];return e.volumenes.forEach(r=>{r.capitulos.forEach(n=>{n.publicado&&t.push(n)})}),t}))}invalidateCache(){this.indexCache$=void 0}preloadIndex(){this.getIndex().subscribe({next:()=>{},error:e=>console.error("\u274C Error precargando \xEDndice:",e)})}static \u0275fac=function(t){return new(t||s)(b(d))};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};export{g as a};
