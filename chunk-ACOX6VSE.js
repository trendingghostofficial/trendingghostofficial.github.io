import{K as g,Ma as u,O as p,Sb as b,Ta as m,g as s,hc as h,j as l,o as d,w as r}from"./chunk-RWH3TDFH.js";var c=class n{constructor(i){this.http=i;this.detectLanguage(),this.loadIdiomasDisponibles(),this.loadUITranslations(this.getCurrentLanguageSync())}currentLang$=new s("es");idiomasDisponibles$=new s([]);uiTranslations={};translationsLoaded$=new s(!1);SUPPORTED_LANGS=["es","en","ja","pt","fr","de","it","ko","zh-CN","zh-TW","ru","pl","tr","hi","ar"];DATA_BASE_URL="https://raw.githubusercontent.com/trendingghostofficial/trending-ghost-data/main";detectLanguage(){let e=new URLSearchParams(window.location.search).get("lang");if(e&&this.SUPPORTED_LANGS.includes(e)){this.setLanguage(e);return}let t=localStorage.getItem("preferred_lang");if(t&&this.SUPPORTED_LANGS.includes(t)){this.setLanguage(t);return}let o=navigator.language.split("-")[0];if(this.SUPPORTED_LANGS.includes(o)){this.setLanguage(o);return}this.setLanguage("es")}setLanguage(i){this.SUPPORTED_LANGS.includes(i)||(console.warn(`[i18n] Idioma no soportado: ${i}, usando 'es'`),i="es"),console.log(`[i18n] \u{1F504} Cambiando idioma a: ${i}`),this.currentLang$.next(i),localStorage.setItem("preferred_lang",i),this.loadUITranslations(i);let e=new URL(window.location.href);e.searchParams.set("lang",i),window.history.replaceState({},"",e.toString()),console.log(`[i18n] \u2705 Idioma actualizado: ${i}, URL: ${e.toString()}`)}getCurrentLanguage(){return this.currentLang$.asObservable()}getCurrentLanguageSync(){return this.currentLang$.value}loadIdiomasDisponibles(){let i="assets/i18n/idiomas.json";console.log(`[i18n] \u{1F4C2} Cargando idiomas disponibles desde: ${i}`),this.http.get(i).pipe(d(e=>{console.log("[i18n] \u{1F4E6} Datos de idiomas.json recibidos:",e);let t=e.idiomas||[],o=t.filter(a=>a.activo===!0);return console.log(`[i18n] \u2705 Idiomas activos filtrados: ${o.length} de ${t.length}`),o}),r(e=>(console.error("[i18n] \u274C Error cargando idiomas:",e),l([{codigo:"es",nombre_nativo:"Espa\xF1ol",nombre_ingles:"Spanish",emoji:"\u{1F1EA}\u{1F1F8}",icono_emoji:"\u{1F1EA}\u{1F1F8}",activo:!0,es_original:!0,capitulos_traducidos:0,capitulos_totales:0,porcentaje:100},{codigo:"en",nombre_nativo:"English",nombre_ingles:"English",emoji:"\u{1F1EC}\u{1F1E7}",icono_emoji:"\u{1F1EC}\u{1F1E7}",activo:!0,es_original:!1,capitulos_traducidos:0,capitulos_totales:0,porcentaje:0},{codigo:"ja",nombre_nativo:"\u65E5\u672C\u8A9E",nombre_ingles:"Japanese",emoji:"\u{1F1EF}\u{1F1F5}",icono_emoji:"\u{1F1EF}\u{1F1F5}",activo:!0,es_original:!1,capitulos_traducidos:0,capitulos_totales:0,porcentaje:0},{codigo:"pt",nombre_nativo:"Portugu\xEAs",nombre_ingles:"Portuguese",emoji:"\u{1F1E7}\u{1F1F7}",icono_emoji:"\u{1F1E7}\u{1F1F7}",activo:!0,es_original:!1,capitulos_traducidos:0,capitulos_totales:0,porcentaje:0},{codigo:"fr",nombre_nativo:"Fran\xE7ais",nombre_ingles:"French",emoji:"\u{1F1EB}\u{1F1F7}",icono_emoji:"\u{1F1EB}\u{1F1F7}",activo:!0,es_original:!1,capitulos_traducidos:0,capitulos_totales:0,porcentaje:0}])))).subscribe(e=>{console.log("[i18n] \u2705 Idiomas disponibles cargados:",e),this.idiomasDisponibles$.next(e)})}getIdiomasDisponibles(){return this.idiomasDisponibles$.asObservable()}loadChapter(i,e){let t=e||this.getCurrentLanguageSync();return this.tryLoadChapter(i,t).pipe(r(o=>(console.warn(`[i18n] Cap\xEDtulo no disponible en ${t}, intentando fallback`),t!=="en"?this.tryLoadChapter(i,"en").pipe(r(()=>this.tryLoadChapter(i,"es"))):this.tryLoadChapter(i,"es"))))}tryLoadChapter(i,e){let t=e==="es"?`${i}.json`:`${i}.${e}.json`,o=`${this.DATA_BASE_URL}/capitulos/${t}`;return this.http.get(o).pipe(d(a=>(a.idioma=e,a)))}isLanguageAvailable(i,e){return i.idiomas_disponibles?.includes(e)||!1}getLanguageName(i){return this.idiomasDisponibles$.value.find(o=>o.codigo===i)?.nombre_nativo||i.toUpperCase()}getLanguageEmoji(i){return this.idiomasDisponibles$.value.find(o=>o.codigo===i)?.emoji||"\u{1F310}"}needsReview(i){return i.traduccion_info?.necesita_revision||!1}getTranslationMethod(i){let e=i.traduccion_info?.metodo;return{manual:"Traducci\xF3n manual",deepl:"Traducido con DeepL",chatgpt:"Traducido con ChatGPT",community:"Traducci\xF3n comunitaria",unavailable:"Traducci\xF3n no disponible"}[e||"unavailable"]||"Traducci\xF3n autom\xE1tica"}loadUITranslations(i){let e=`assets/i18n/${i}.json`;console.log(`[i18n] \u{1F4C2} Cargando traducciones UI desde: ${e}`),this.http.get(e).pipe(r(t=>(console.error(`[i18n] \u274C Error cargando traducciones UI para ${i}:`,t),i!=="es"?(console.log("[i18n] \u{1F504} Fallback a espa\xF1ol..."),this.http.get("assets/i18n/es.json")):l({})))).subscribe(t=>{this.uiTranslations=t,this.translationsLoaded$.next(!0),console.log(`[i18n] \u2705 Traducciones de UI cargadas: ${i}`,Object.keys(t).length,"claves")})}getTranslation(i){if(!this.translationsLoaded$.value)return console.warn("[i18n] Traducciones a\xFAn no cargadas, retornando key"),i;let e=i.split("."),t=this.uiTranslations;for(let o of e)if(t&&typeof t=="object"&&o in t)t=t[o];else return console.warn(`[i18n] Traducci\xF3n no encontrada: ${i}`),i;return typeof t=="string"?t:i}areTranslationsLoaded(){return this.translationsLoaded$.value}onTranslationsLoaded(){return this.translationsLoaded$.asObservable()}static \u0275fac=function(e){return new(e||n)(p(h))};static \u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})};var f=class n{constructor(i,e){this.i18n=i;this.cdr=e;this.langSubscription=this.i18n.getCurrentLanguage().subscribe(t=>{this.lastLang!==t&&(this.lastLang=t,this.cdr.markForCheck())}),this.translationsSubscription=this.i18n.onTranslationsLoaded().subscribe(t=>{t&&this.cdr.markForCheck()})}lastLang="";langSubscription;translationsSubscription;ngOnDestroy(){this.langSubscription?.unsubscribe(),this.translationsSubscription?.unsubscribe()}transform(i,e){let t=this.i18n.getTranslation(i);return e&&t&&Object.keys(e).forEach(o=>{let a=new RegExp(`{{\\s*${o}\\s*}}`,"g");t=t.replace(a,e[o])}),t}static \u0275fac=function(e){return new(e||n)(u(c,16),u(b,16))};static \u0275pipe=m({name:"translate",type:n,pure:!1})};export{c as a,f as b};
