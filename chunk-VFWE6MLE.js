import{C as p,K as m,O as b,hc as d,j as u,o as a,w as l}from"./chunk-RWH3TDFH.js";var g=class s{constructor(e){this.http=e}WORKER_URL="https://worker-data.trendingghostofficial.workers.dev/api/data";FALLBACK_URL="/data";indexCache$;useWorker=!0;getIndex(){if(!this.indexCache$){let e=this.useWorker?`${this.WORKER_URL}/arcs`:`${this.FALLBACK_URL}/arcs.json`;this.indexCache$=this.http.get(e).pipe(a(t=>{let i=t.volumenes.map(r=>({numero:r.numero,titulo:r.titulo,subtitulo:r.subtitulo||"",rango:r.rango,estado:r.estado,color_tema:r.color_tema,capitulos_publicados:r.capitulos_publicados||0,fecha_inicio:r.fecha_inicio,fecha_fin_estimada:r.fecha_fin_estimada,capitulos:(r.capitulos||[]).map(o=>({numero:o.numero,titulo:o.titulo,slug:o.slug,fecha:o.fecha_publicacion||"",publicado:o.publicado===1||o.publicado===!0,minutos:o.minutos_lectura||0,palabras:o.palabras||0,icono:o.icono||"\u{1F4D6}",excerpt:o.excerpt||null}))})),n=i.reduce((r,o)=>r+o.capitulos.length,0),h=i.reduce((r,o)=>r+o.capitulos.filter(_=>_.publicado).length,0),c="",f="";return i.forEach(r=>{r.capitulos.forEach(o=>{o.publicado&&o.fecha&&o.fecha>c&&(c=o.fecha)})}),{total:n,publicados:h,ultimo_publicado:c,proximo_publicacion:f||void 0,volumenes:i}}),p(1),l(t=>(console.error("\u274C Error cargando arcs.json:",t),u({total:0,publicados:0,ultimo_publicado:"",volumenes:[]}))))}return this.indexCache$}getCapitulo(e){let t=this.useWorker?`${this.WORKER_URL}/capitulos/${e}`:`${this.FALLBACK_URL}/capitulos/${e}.json`;return this.http.get(t).pipe(l(i=>(console.error(`\u274C Error cargando cap\xEDtulo ${e}:`,i),this.useWorker?(console.warn("\u26A0\uFE0F  Worker fall\xF3, intentando fallback local..."),this.http.get(`${this.FALLBACK_URL}/capitulos/${e}.json`).pipe(l(()=>u(null)))):u(null))))}getCapituloPorNumero(e,t){let i=`v${e}-c${t}`;return this.getCapitulo(i)}getCapitulosDelVolumen(e){return this.getIndex().pipe(a(t=>{let i=t.volumenes.find(n=>n.numero===e);return i?i.capitulos:[]}))}getVolumen(e){return this.getIndex().pipe(a(t=>t.volumenes.find(i=>i.numero===e)||null))}getVolumenes(){return this.getIndex().pipe(a(e=>e.volumenes))}getProgresoVolumen(e){return this.getCapitulosDelVolumen(e).pipe(a(t=>t.length===0?0:t.filter(n=>n.publicado).length/t.length*100))}getProgresoGlobal(){return this.getIndex().pipe(a(e=>e.total===0?0:e.publicados/e.total*100))}getCapitulosPublicados(){return this.getIndex().pipe(a(e=>{let t=[];return e.volumenes.forEach(i=>{i.capitulos.forEach(n=>{n.publicado&&t.push(n)})}),t}))}invalidateCache(){this.indexCache$=void 0,console.log("\u267B\uFE0F Cache del \xEDndice invalidado")}preloadIndex(){this.getIndex().subscribe({next:()=>console.log("\u2705 \xCDndice de cap\xEDtulos precargado"),error:e=>console.error("\u274C Error precargando \xEDndice:",e)})}static \u0275fac=function(t){return new(t||s)(b(d))};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};export{g as a};
