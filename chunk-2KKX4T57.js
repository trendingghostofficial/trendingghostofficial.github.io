import{a as d}from"./chunk-K6AXLRK5.js";import{B as p,I as m,L as b,j as s,n as a,v as c}from"./chunk-YRNHRO3O.js";var g=class u{constructor(e){this.http=e}BASE_URL="/data";indexCache$;getIndex(){return this.indexCache$||(this.indexCache$=this.http.get(`${this.BASE_URL}/arcs.json`).pipe(a(e=>{let t=e.volumenes.map(i=>({numero:i.numero,titulo:i.titulo,subtitulo:i.subtitulo||"",rango:i.rango,estado:i.estado,color_tema:i.color_tema,capitulos_publicados:i.capitulos_publicados||0,fecha_inicio:i.fecha_inicio,fecha_fin_estimada:i.fecha_fin_estimada,capitulos:(i.capitulos||[]).map(o=>({numero:o.numero,titulo:o.titulo,slug:o.slug,fecha:o.fecha_publicacion||"",publicado:o.publicado===1||o.publicado===!0,minutos:o.minutos_lectura||0,palabras:o.palabras||0,icono:o.icono||"\u{1F4D6}",excerpt:o.excerpt||null}))})),n=t.reduce((i,o)=>i+o.capitulos.length,0),r=t.reduce((i,o)=>i+o.capitulos.filter(f=>f.publicado).length,0),l="",h="";return t.forEach(i=>{i.capitulos.forEach(o=>{o.publicado&&o.fecha&&o.fecha>l&&(l=o.fecha)})}),{total:n,publicados:r,ultimo_publicado:l,proximo_publicacion:h||void 0,volumenes:t}}),p(1),c(e=>(console.error("\u274C Error cargando arcs.json:",e),s({total:0,publicados:0,ultimo_publicado:"",volumenes:[]}))))),this.indexCache$}getCapitulo(e){return this.http.get(`${this.BASE_URL}/capitulos/${e}.json`).pipe(c(t=>(console.error(`\u274C Error cargando cap\xEDtulo ${e}:`,t),s(null))))}getCapituloPorNumero(e,t){let n=`v${e}-c${t}`;return this.getCapitulo(n)}getCapitulosDelVolumen(e){return this.getIndex().pipe(a(t=>{let n=t.volumenes.find(r=>r.numero===e);return n?n.capitulos:[]}))}getVolumen(e){return this.getIndex().pipe(a(t=>t.volumenes.find(n=>n.numero===e)||null))}getVolumenes(){return this.getIndex().pipe(a(e=>e.volumenes))}getProgresoVolumen(e){return this.getCapitulosDelVolumen(e).pipe(a(t=>t.length===0?0:t.filter(r=>r.publicado).length/t.length*100))}getProgresoGlobal(){return this.getIndex().pipe(a(e=>e.total===0?0:e.publicados/e.total*100))}getCapitulosPublicados(){return this.getIndex().pipe(a(e=>{let t=[];return e.volumenes.forEach(n=>{n.capitulos.forEach(r=>{r.publicado&&t.push(r)})}),t}))}invalidateCache(){this.indexCache$=void 0,console.log("\u267B\uFE0F Cache del \xEDndice invalidado")}preloadIndex(){this.getIndex().subscribe({next:()=>console.log("\u2705 \xCDndice de cap\xEDtulos precargado"),error:e=>console.error("\u274C Error precargando \xEDndice:",e)})}static \u0275fac=function(t){return new(t||u)(b(d))};static \u0275prov=m({token:u,factory:u.\u0275fac,providedIn:"root"})};export{g as a};
